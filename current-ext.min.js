var emoteKeyLookup={13:function(a){emoteSelectSubmit(a)},40:function(a){selectedPopover?(selectedPopover.removeClass("active"),next=selectedPopover.next(),selectedPopover=0<next.length?next.addClass("active"):selectedPopover.eq(0).addClass("active")):selectedPopover=selectedPopover.eq(0).addClass("active")},38:function(a){selectedPopover?(selectedPopover.removeClass("active"),next=selectedPopover.prev(),selectedPopover=0<next.length?next.addClass("active"):selectedPopover.last().addClass("active")):
selectedPopover=selectedPopover.last().addClass("active")},9:function(a){emoteSelectSubmit(a)}},chatKeyLookup={13:function(a){if(!window.CHATTHROTTLE&&(a=chatlineElem.val().trim(),""!==a)){var c={};window.USEROPTS.adminhat&&255<=window.CLIENT.rank?a="/a "+a:window.USEROPTS.modhat&&window.CLIENT.rank>=window.Rank.Moderator&&(c.modflair=window.CLIENT.rank);2<=window.CLIENT.rank&&0===a.indexOf("/m ")&&(c.modflair=window.CLIENT.rank,a=a.substring(3));var b=a.split(" ");if(chatCmdLookup.hasOwnProperty(b[0]))chatCmdLookup[b[0]](b);
else window.socket.emit("chatMsg",{msg:a,meta:c});window.CHATHIST.push(chatlineElem.val());window.CHATHISTIDX=window.CHATHIST.length;chatlineElem.val("")}},9:function(a){a.preventDefault();return!1},38:function(a){window.CHATHISTIDX===window.CHATHIST.length&&window.CHATHIST.push(chatlineElem.val());0<window.CHATHISTIDX&&(window.CHATHISTIDX--,chatlineElem.val(window.CHATHIST[window.CHATHISTIDX]));a.preventDefault();return!1},40:function(a){window.CHATHISTIDX<window.CHATHIST.length-1&&(window.CHATHISTIDX++,
chatlineElem.val(window.CHATHIST[window.CHATHISTIDX]));a.preventDefault();return!1}},emoteSelectSubmit=function(a){selectedPopover&&(a.preventDefault(),appendEmote($("tr.active")),emoteList.hide(),selectedPopover=null,emoteTable=!1);return!1},editJs=function(a,c){if(1<c.length&&2<=window.CLIENT.rank){var b=jsTextField.val(),d=b.split("\n"),e=d[a].substr(0,d[a].lastIndexOf(" = ")+1);b=b.replace(d[a],e+"= '"+c[1].replace(/['"]+/g,"").trim()+"';");jsTextField.val(b);$(document.getElementById("cs-jssubmit")).click()}},
waitForEl=function(a,c){$(a).length?c():setTimeout(function(){waitForEl(a,c)},100)};function chatHandler(a){if(emoteTable){if(a.stopImmediatePropagation(),emoteKeyLookup.hasOwnProperty(a.which))emoteKeyLookup[a.which](a)}else if(chatKeyLookup.hasOwnProperty(a.which))chatKeyLookup[a.which](a);return!0}
function preloadImages(a){preloadImages.list||(preloadImages.list=[]);for(var c=preloadImages.list,b=0;b<a.length;b++){var d=new Image;d.onload=function(){var a=c.indexOf(this);-1!==a&&c.splice(a,1)};c.push(d);d.src=a[b]}}function deleteAllPlaylist(a){a.each(function(a,b){$(b).find("button.qbtn-delete").click()})}
function cleanAutoStart(){var a=queueList.children(":visible");queueList.find("button.btn-auto-keep").remove();a.each(function(a,b){$(b).removeAttr("data-keep");$(b).removeClass("list-keep")})}function fetchEmote(){emoteArray=CHANNEL.emotes.map(function(a){return{name:a.name,image:a.image}})}function videoDisplayToggle(){"0 items"==$(document.getElementById("plcount"))[0].innerHTML?$(document.getElementById("videowrap")).hide():$(document.getElementById("videowrap")).show()}
function autoStartHandler(){"true"==motdMode.attr("data-value")&&(queueList.find("button.btn-auto-keep").remove(),queueList.children(":visible").each(function(a,c){$(c).find("button.qbtn-next").before("<button class='btn btn-xs btn-default btn-auto-keep'><span class='glyphicon glyphicon-ok'></span>AutoStart</button>");$(c).attr("data-keep","false")}))}
function populateEmote(){fetchEmote();chatlineElem.before("<div id='emote-data-field' hidden></div>");emoteList=$(document.getElementById("emote-data-field"));preloadImages(emoteArray.map(function(a){return a.image}))}function appendEmote(a){var c=chatlineElem.val(),b=c.lastIndexOf(" ");chatlineElem.val("");chatlineElem.val(c.substr(0,b+1)+a.attr("data-value"));chatlineElem.focus()}
function bindEventHandler(){$(bodyElem).on("click","#emote-data-field",function(a){appendEmote($(a.target).closest("tr"));emoteList.hide();emoteTable=!1});$(bodyElem).on("input","#chatline",function(a){a=this.value.lastIndexOf(" ");var c=this.value.substr(a+1);$(this);if(":"==c.substr(0,1)&&2<c.length)if(emoteList[0].innerHTML="",a=emoteArray.filter(function(a){return-1<a.name.indexOf(c.substr(1,c.length))}),":"==c.substr(c.length-1)||0==a.length)emoteList.hide(),selectedPopover=null,emoteTable=!1;
else{var b="<table class='table table-sm table-hover emote-table'><tbody>";a.forEach(function(a,c){b+="<tr class='selectEmote "+(0==c?"active":"")+"' data-value='"+a.name+"'>";b+="<td width='20%'><img class='smol-emote' src='"+a.image+"'></td>";b+="<td width='80%'>"+a.name+"</td>";b+="</tr>"});b+="</tbody></table>";emoteList[0].innerHTML=b;selectedPopover=$("tr.active");emoteTable=!0;emoteList.show()}else chatlineElem.on("keydown",handlerKeydown),emoteList.hide(),selectedPopover=null,emoteTable=!1});
$(bodyElem).on("click","#emotelistbtn",function(){fetchEmote()});$(bodyElem).on("focusout","#chatline",function(){if(emoteList[0].matches(":hover"))return!1;emoteList.hide();emoteTable=!1});$(bodyElem).on("click",".btn-auto-keep",function(){var a=$(this).closest("li"),c=queueList.children(":visible"),b=a.attr("data-keep");b="false"==b?"true":"false";c.each(function(a,b){$(b).attr("data-keep","false");$(b).removeClass("list-keep")});"false"==b?a.removeClass("list-keep"):a.addClass("list-keep");a.attr("data-keep",
b);a=a.find("a.qe_title")[0].innerHTML;window.socket.emit("chatMsg",{msg:"Autostart - ["+a+"]"})});$(bodyElem).on("DOMSubtreeModified","#plcount",function(a){videoDisplayToggle();autoStartHandler()});$(bodyElem).on("click",".export",function(){var a=$("#cs-chanlog-text").text().replace(/\n/g,"\r\n");this.href="data:text/plain;charset=UTF-8,"+encodeURIComponent(a)});$(bodyElem).on("hidden.bs.collapse","#collapseMessage",function(){collapseArrow[0].classList.remove("glyphicon-chevron-up");collapseArrow[0].classList.add("glyphicon-chevron-down")});
$(bodyElem).on("show.bs.collapse","#collapseMessage",function(){collapseArrow[0].classList.remove("glyphicon-chevron-down");collapseArrow[0].classList.add("glyphicon-chevron-up")});$(bodyElem).on("mousedown",".qbtn-delete",function(){$(this).prop("disabled",!0);$(this).click();window.socket.emit("chatMsg",{msg:"video deleted"})})}
$(document).ready(function(){document.getElementById("export-btn")||($(document.getElementById("cs-chanlog")).append(" <a class='export' id='export-btn' href='#' download='chat.txt'><button class='btn btn-default'>Export</button></a>"),bindEventHandler());waitForEl("#club_redirect",function(){$("#club_redirect").attr("href",href_url);$("#club_banner").attr("src",banner_url);collapseArrow=$(document.getElementById("collapseArrow"))});waitForEl("#club_banner",function(){$("#club_banner").attr("src",
banner_url)});waitForEl("#chatline",function(){chatlineElem=$(document.getElementById("chatline"));populateEmote();chatlineElem.off("keydown");chatlineElem.on("keydown",function(a){chatHandler(a)})});waitForEl("span#plcount",function(){queueList=$(document.getElementById("queue"));videoDisplayToggle();autoStartHandler()});waitForEl("#motd-mode",function(){motdMode=$(document.getElementById("motd-mode"))});waitForEl("#backg",function(){$(document.getElementById("backg")).css("background-image","url("+
background_img+")")})});